<?xml version="1.0" encoding="UTF-8"?>
<!-- EN-Revision: fe776e93a129855c2abb623341318f9f1813e57e Maintainer: ae Status: ready --><!-- CREDITS: ernani,narigone,ae -->
   <sect1 xml:id="install.unix.apache2" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Apache 2.x on Unix systems</title>
    <para>
     Esta seção contém notas e dicas específicas a instalação do PHP em Apache 2.x
     em sistemas Unix.
    </para>
   
    &warn.apache2.compat;
    
    <para>
     A <link xlink:href="&url.apache2.docs;">documentação do Apache</link> 
     é a fonte mais importante sobre o servidor Apache 2.x.
     Mais informações sobre opções de instalação podem ser encontradas
     lá.
    </para>

    <para>
     A versão mais recente do servidor Apache HTTP pode ser obtida do
     <link xlink:href="&url.apache;">site de download Apache</link>,
     e uma versão correspondente do PHP pode ser obtida dos locais mencionados anterioremente.
     Esse guai rápido cobre apenas o básico para iniciar o Apache 2.x
     e PHP. Para mais informações leia a
     <link xlink:href="&url.apache2.docs;">documentação do Apache</link>.
     Os números de versão estão omitidos aqui, para garantir que
     as instruções não fiquem desatualizadas. Nos exemplos abaixo 'NN' deve
     ser substituídos com as versões específicas do Apache.
    </para>

    <para>
     Atualmente há duas versões do Apache 2.x. - 2.0 e 2.2.
     Embora haja razões para escolher entre elas, 2.2 é a versão mais
     atual, e aquela recomendada, se essa opção lhe for
     possível. Entretanto as instruções aqui funcionarão para
     ambas as versões 2.0 e 2.2.
    </para>

     <orderedlist>
     <listitem>
     <para>Obter o Apache HTTP do endereço acima, e
     descompactar:</para>

     <example>
     <screen>
<![CDATA[
gzip -d httpd-2_x_NN.tar.gz
tar -xf httpd-2_x_NN.tar
]]>
     </screen>
     </example>
     </listitem>

     <listitem>
     <para>Da mesma forma, obter o descompactar os fontes do PHP:</para>

     <example>
     <screen>
<![CDATA[
gunzip php-NN.tar.gz
tar -xf php-NN.tar
]]>
     </screen>
     </example>
     </listitem>
   
     <listitem>
     <para>
     Compilar e instalar o Apache. Consulte a documentação de instalação do Apache
     para mais detalhes/opções de compilação.
     </para>

     <example>
     <screen>
<![CDATA[
cd httpd-2_x_NN
./configure --enable-so
make
make install
]]>
     </screen>
     </example>
     </listitem>

     <listitem>
 <para>
    Você agora tem um Apache 2.x.NN disponível em /usr/local/apache2,
    configurado com módulos carregáveis e o MPM prefork padrão.
    Para testar a instalação utilize o procedimento de inicializaçaõ
    do servidor Apache. Por exemplo:

    <example>
    <screen>
<![CDATA[
/usr/local/apache2/bin/apachectl start
]]>
    </screen>
    </example>

    e depois pare o servidor para configurar o PHP:

    <example>
    <screen>
<![CDATA[
/usr/local/apache2/bin/apachectl stop
]]>
    </screen>
    </example>
 </para>
 </listitem>

 <listitem>

<para>
Agora configure e compile o PHP. Aqui você pode personalizar o PHP
com várias opções, por exemplo quais extensões estarão disponíveis. Rode
./configure --help para uma lista de opções disponíveis. Em nosso exemplo
nós iremos configurar apenas com suporte ao Apache 2 e MySQL.
</para>

<para>
Se você compilou o Apache a partir dos fontes como descrito acima o exemplo abaixo terão
caminhos coincidentes do apxs, mas se instalou de outra forma você terá de
ajustar o caminho para o apxs. Algumas distribuições renomeiam
apxs para apxs2.
 </para>
     <example>
     <screen>
<![CDATA[
cd ../php-NN
./configure --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql
make
make install
]]>
      </screen>
     </example>

     <para>
    Se decidir modificar suas configurações depois da instalação você
    terá de rodar novamente o configure, make e make install.
    Terá também de
    reiniciar o Apache para que o novo módulo seja carregado. Uma recompilação do
    Apache não é necessária.
    </para>
         
    <para>
    Note que por padrão 'make install' também instalará o PEAR,
    várias ferramentas do PHP como phpize, instalar o PHP CLI, entre outros.
    </para>

    </listitem>

  <listitem>
  <para>
  Configure seu php.ini:
  </para>
    
     <example>
     <screen>
<![CDATA[
cp php.ini-development /usr/local/lib/php.ini
]]>
      </screen>
     </example>

    <para>
    Você pode editar seu arquivo .ini para configurar o PHP. Se preferir ter
    um php.ini em outra localização, utilize --with-config-file-path=/some/path no
    passo 5.
    </para>
   
    <para>
    Se preferir utilizar o php.ini-production leia atentamente a lista
    esse arquivo, dado que ele modifica o comportamento do PHP.
    </para>

    </listitem>

    <listitem>

 <para>
  Edite seu httpd.conf para carregar o módulo do PHP. O caminho a direita
  da instrução LoadModule precisa apontar para o caminho do módulo do PHP
  em seu sistema. O 'make install' acima pode ter feito isso
  por você, mas é bom confirmar.
</para>

      <example>
        <programlisting role="apache-conf">
<![CDATA[
LoadModule php5_module modules/libphp5.so
]]>
       </programlisting>
      </example>

      </listitem>

      <listitem>

    <para>
    Diga ao Apache para interpretar certas extensões de arquivos do PHP. Por exemplo configurar
    o Apache para interpretar aquivos .php. Em vez de utilizar apenas a diretiva Apache AddType
    é recomendado evitar uploads potencialmente perigosos e nomes de
    arquivos como exploit.php.jpg de serem executados pelo PHP. Nesse exemplo
    você pode ter qualquer extensão (ou extensões) configuradas.
    Adicionaremos .php como demonstração.
    </para>


      <example>
        <programlisting role="apache-conf">
<![CDATA[
<FilesMatch \.php$>
    SetHandler application/x-httpd-php
</FilesMatch>
]]>
       </programlisting>
      </example>

    <para>
     Ou, pode-se acrescentar também .php, .php2, .php3, .php4, .php5, .php6 e
    .phtml para ser executado como PHP, desta forma:
    </para>

      <example>
        <programlisting role="apache-conf">
<![CDATA[
<FilesMatch "\.ph(p[2-6]?|tml)$">
    SetHandler application/x-httpd-php
</FilesMatch>
]]>
       </programlisting>
      </example>

    <para>
     Para permitir que arquivos .phps seja interpretados pelo filtro de fontes do PHP,
     mostrados como código fonte destacado, utilize isso:
    </para>

      <example>
        <programlisting role="apache-conf">
<![CDATA[
<FilesMatch "\.phps$">
    SetHandler application/x-httpd-php-source
</FilesMatch>
]]>
       </programlisting>
      </example>

    <para>
    mod_rewrite pode ser utilizado para permitir que qualquer arquivo .php seja exibido
    como código fonte destacado, sem ter de renomear ou copiar aquivos
    para a extensão .phps, assim:
   </para>

      <example>
        <programlisting role="apache-conf">
<![CDATA[
RewriteEngine On
RewriteRule (.*\.php)s$ $1 [H=application/x-httpd-php-source]
]]>
       </programlisting>
      </example>

    <para>
    O filtro de fontes PHP não deve ser ativado em ambiente de produção, onde
    ele pode expor dados confidenciais ou de outra forma importantes, que esteja
    incluídos no código fonte.
    </para>

    </listitem>

    <listitem>
   <para>
   Depois utilize a forma normal de iniciar o servidor Apache:
   </para>
  
   <example>
   <screen>
<![CDATA[
/usr/local/apache2/bin/apachectl start
]]>
       </screen>
      </example>

          <para>ou</para>

   <example>
   <screen>
<![CDATA[
service httpd restart
]]>
       </screen>
      </example>

   </listitem>
     </orderedlist>

    <para>
     Seguindo os passos acima você terá um Apache2 rodando com
     suporte ao PHP como um módulo <literal>SAPI</literal>.  Existem muitas outras
     opções de configuração disponíveis no Apache e PHP. Para mais
     informações rode <command>./configure --help</command> na código
     fonte correspondente.
    </para>
    <para>
     Apache pode ser construído com multithread através da seleção do MPM
     <filename>worker</filename>, em vez do padrão MPM
     <filename>prefork</filename>. Isso é possível
     acrescentado-se os seguintes argumentos no ./configure do
     passo 3 acima:
    </para>
    <example>
    <screen>
<![CDATA[
--with-mpm=worker
]]>
    </screen>
    </example>
    <para>
     Isso não deve ser feito sem conhecer as consequências
     dessa decisão, ou pelo menos ter uma boa noção de
     suas implicações. A documentação do Apache
     sobre <link xlink:href="&url.apache2.mpm;">MPM-Modules</link>
     discute essas questões em grandes detalhes.
    </para>
    <note>
     <para>
      A <link linkend="faq.installation.apache.multiviews">Apache MultiViews 
      FAQ</link> discute multiviews com o PHP.
     </para>
    </note>
    <note>
     <para>
      Para construir uma versão multithread o sistema destino precisa suportar threads.
      Nesse caso o PHP também deve ser compilado com o (experimental)
      Zend Thread Safety (ZTS). Nessa configuração nem todas as extensões estarão disponíveis.
      A configuração recomendada é construir o Apache com o módulo MPM
      <filename>prefork</filename> padrão.
     </para>
    </note>
   </sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
