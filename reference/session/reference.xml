<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.8 $ -->
 <reference id="ref.session">
  <title>Manejo de sess&otilde;es</title>
  <titleabbrev>Sess&otilde;es</titleabbrev>
	
  <partintro>
  
   <section id="session.intro">
    &reftitle.intro;
    <para>
      Suporte a sess&otilde;es no PHP consiste em uma forma de preservar certos dados
    atrav&eacute;s de acessos subseq&uuml;entes. Isto te permite construir aplica&ccedil;&otilde;es mais 
	personalizadas e aumenta a atra&ccedil;&atilde;o ao seu web site.
    </para>
    <para>
     Se voc&ecirc; est&aacute; familiarizado com o gerenciamento de sess&otilde;es do PHPLIB, voc&ecirc;
    ir&aacute; notar que alguns conceitos s&atilde;o similares ao suporte de sess&otilde;es do PHP.
    </para>
    <para>
     Um visitante acessando seu web site est&aacute; determinado por uma &uacute;nica id, a
    ent&atilde;o chamada id de sess&atilde;o. Esta ou &eacute; guardada em um cookie do lado do usu&aacute;rio
    ou est&aacute; na URL.
    </para>
    <para>
     Sess&otilde;es te permite registrar arbitrariamente n&uacute;meros de vari&aacute;veis
    para estarem lado a lado com os requerimentos. Quando um visitante 
    acessa seu site, o PHP checar&aacute; automaticamente (se session.auto_start 
    est&aacute; definida para  1) ou no seu pedido (explicitamente atrav&eacute;s da
	<function>session_start</function> ou implicitamente atrav&eacute;s da
    <function>session_register</function>) se uma id de sess&atilde;o especifica
    foi enviada com o pedido. Se este &eacute; o caso, o ambiente
    anterior guardado &eacute; restaurado.
    </para>
    <para>
     Todas as vari&aacute;veis registradas s&atilde;o publicadas em s&eacute;rie ap&oacute;s o pedido
    terminar.  Vari&aacute;veis registradas que est&atilde;o indefinidas est&atilde;o marcadas 
	como estando n&atilde;o definida. Num acesso subseq&uuml;ente, estas n&atilde;o estar&atilde;o 
	definidas pelo m&oacute;dulo da sess&atilde;o a menos que o usu&aacute;rio defina elas mais tarde.
    </para>
    <note>
     <para>
      Manejo de sess&otilde;es foi adicionado no PHP 4.0.
     </para>
    </note>
   </section>
   
   <section id="session.requirements">
    &reftitle.required;
    &no.requirement;
   </section>

   <section id="session.installation">
    &reftitle.install;
    <para>
     Suporte a sess&otilde;es esta habilitado no PHP 4.0 por defini&ccedil;&atilde;o. Se voc&ecirc;
     n&atilde;o gostaria de seu PHP com suporte a sess&atilde;o, voc&ecirc;  
     especifica a  op&ccedil;&atilde;o de configura&ccedil;&atilde;o <option role="configure">--disable-session</option>.
    </para>
   </section>

   <section id="session.configuration">
    &reftitle.runtime;
    <para>
     O sistema de suporte de sess&atilde;o oferece no arquivo &php.ini; numerosas
     op&ccedil;&otilde;es de configura&ccedil;&atilde;o. n&oacute;s daremos um breve resumo.
     <itemizedlist>
      <listitem>
       <simpara>
        <literal>session.save_handler</literal>define o nome do operador(fun&ccedil;&otilde;es-handler)
       que &eacute; usado para guardar e resgatar dados
       associados com a sess&atilde;o. Por defini&ccedil;&atilde;o  
        <literal>files</literal>.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.save_path</literal> define o argumento que 
       que &eacute; passado para o save handler. Se voc&ecirc; escolher o default files
       handler, este &eacute; o caminho onde os arquivos ser&atilde;o criados.
       Por defini&ccedil;&atilde;o para <literal>/tmp</literal>. Se a profundidade do caminho de
       <literal>session.save_path</literal> &eacute; maior do que
       2, cole&ccedil;&atilde;o de lixo n&atilde;o ser&aacute; executada(garbage collection - gc).
       </simpara>
       <warning>
        <para>
         Se voc&ecirc; deixar isto definido para um diret&oacute;rio muito vis&iacute;vel, tal como
        <filename>/tmp</filename> (o padr&atilde;o), outros usu&aacute;rios do servidor
        poder&atilde;o ser capazes de assumir o controle da sess&atilde;o obtendo a lista de arquivos
        naquele diret&oacute;rio.
        </para>
       </warning>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.name</literal> especifica o nome da sess&atilde;o
       que &eacute; usada como nome de cookie. Ela poderia apenas conter
       caracteres alfanum&eacute;ricos. Por defini&ccedil;&atilde;o
       <literal>PHPSESSID</literal>.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.auto_start</literal> especifica se o m&oacute;dulo
       da sess&atilde;o inicia a sess&atilde;o automaticamente num pedido na inicializa&ccedil;&atilde;o.
	    Por defini&ccedil;&atilde;o <literal>0</literal> (desabilitado).
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.cookie_lifetime</literal> especifica o tempo de vida
       de um cookie em segundos que &eacute; enviado para o navegador. O valor 0
       significa "at&eacute; que o navegador seja fechado." Por defini&ccedil;&atilde;o
        <literal>0</literal>.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.serialize_handler</literal> define o nome
       do operador(handler) que &eacute; usado para serializar/deserializar
       dados. Correntemente, um formato interno do PHP (nome
       <literal>php</literal>) e WDDX &eacute; suportado (nome
       <literal>wddx</literal>). WDDX est&aacute; apenas dispon&iacute;vel, se o PHP 
	   est&aacute; compilado com o suporte<link linkend="ref.wddx">WDDX
        support</link>. Por defini&ccedil;&atilde;o <literal>php</literal>.
        </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.gc_probability</literal> especifica a
       probabilidade que a rotina gc (cole&ccedil;&atilde;o de lixo-garbage collection) &eacute; 
	   iniciada em cada pedido em porcentagem. Por defini&ccedil;&atilde;o <literal>1</literal>.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.gc_maxlifetime</literal> especifica o n&uacute;mero 
	   de segundos depois que o dado ser&aacute; visto como 'lixo' e 
       limpado.  
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.referer_check</literal> cont&eacute;m a substring que voc&ecirc;
       quer checar cada HTTP Referer para. Se o Referer foi enviado pelo 
       cliente e a substring n&atilde;o foi encontrada, a id de sess&atilde;o embutida 
       ser&aacute; percebida como inv&aacute;lida. Por defini&ccedil;&atilde;o uma string vazia.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.entropy_file</literal> d&aacute; um caminho para um 
	   recurso externo(file) que ser&aacute; usado como um entropy source 
	   na cria&ccedil;&atilde;o da id de sess&atilde;o. S&atilde;o exemplos
       <literal>/dev/random</literal> ou
       <literal>/dev/urandom</literal> que est&atilde;o dispon&eacute;veis em muitos
       Sistemas Unix.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.entropy_length</literal> especif&iacute;ca o n&uacute;mero
	    de bytes que ser&atilde;o lidos do arquivo especificado acima.
		 Por defini&ccedil;&atilde;o <literal>0</literal> (desabilitada).
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.use_cookies</literal> especifica se o 
       m&oacute;dulo usar&aacute; cookies para gravar a id de sess&atilde;o no lado 
       do cliente. Por defini&ccedil;&atilde;o <literal>1</literal> (habilitada).
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.use_only_cookies</literal> especifica se
       o m&oacute;dulo usar&aacute;<emphasis role="strong">apenas</emphasis> cookies para
       gravar a id de sess&atilde;o no lado do cliente. Por defini&ccedil;&atilde;o
       <literal>0</literal> (desabilitada). Habilitar esta
       defini&ccedil;&atilde;o previni ataques envolvendo id de sess&atilde;o passadas em URLs.
       Esta defini&ccedil;&atilde;o foi adicionada no <literal>PHP</literal> 4.3.0.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.cookie_path</literal> especifica o caminho para 
       definir em session_cookie. Por defini&ccedil;&atilde;o <literal>/</literal>.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.cookie_domain</literal> especifica o dom&iacute;nio para 
       para definir em session_cookie. Nenhuma defini&ccedil;&atilde;o. 
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.cache_limiter</literal> especifica o m&eacute;todo 
        de controle do cache para usar para p&aacute;ginas de sess&atilde;o
       (none/nocache/private/private_no_expire/public).  Por defini&ccedil;&atilde;o
       <literal>nocache</literal>.
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>session.cache_expire</literal> especifica o tempo de vida
        para p&aacute;ginas de sess&atilde;o no cache em minutos, isto n&atilde;o tem efeito para
        para limitador sem cache. Por defini&ccedil;&atilde;o <literal>180</literal>.
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <literal>session.use_trans_sid</literal> se o suporte de sid transparente 
	   est&aacute; habilitado ou n&atilde;o, se habilitado por compila&ccedil;&atilde;o com 
       <link linkend="install.configure.enable-trans-sid">
        <literal>--enable-trans-sid</literal></link>.
       Por defini&ccedil;&atilde;o <literal>1</literal> (habilitado).
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       <literal>url_rewriter.tags</literal> especifica quais  tags html est&atilde;o
       reescritas para incluir id de sess&atilde;o se o suporte transparente de sid est&aacute; habilitado. 
       Por defini&ccedil;&atilde;o <literal>a=href,area=href,frame=src,input=src,form=fakeentry</literal>
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <para>
     A configura&ccedil;&atilde;o de <link
    linkend="ini.track-vars"><literal>track_vars</literal></link> e
    <link
    linkend="ini.register-globals"><literal>register_globals</literal></link>
     influencia em como as vari&aacute;veis da sess&atilde;o conseguem 
	 armazenar e devolver.
    </para>

    <note>
     <para>
      No PHP 4.0.3, <link
      linkend="ini.track-vars"><literal>track_vars</literal></link> est&aacute;
      sempre ligada.
     </para>
    </note>
   </section>

   <section id="session.resources">
    &reftitle.resources;
    &no.resource;
   </section>

   &reference.session.constants;

   <section id="session.examples">
    &reftitle.examples;
    <note>
     <para>
      No PHP 4.1.0, <varname>$_SESSION</varname> est&aacute; dispon&iacute;vel como
     vari&aacute;vel global apenas como <varname>$_POST</varname>,
     <varname>$_GET</varname>, <varname>$_REQUEST</varname> e assim por diante.
     N&atilde;o como <varname>$HTTP_SESSION_VARS</varname>,
     <varname>$_SESSION</varname> est&aacute; sempre global. Ent&atilde;o,
     <literal>global</literal> poderia n&atilde;o ser usada para
     <varname>$_SESSION</varname>.
     </para>
    </note>

   <para>
     Se <link
     linkend="ini.track-vars"><literal>track_vars</literal></link> is
     habilitada e <link
     linkend="ini.register-globals"><literal>register_globals</literal></link>
     est&aacute; desabilitada, apenas aquelas membros da matriz associativa
     <varname>$HTTP_SESSION_VARS</varname> podem ser registradas em uma sess&atilde;o
    de vari&aacute;veis. A sess&atilde;o de vari&aacute;veis restauradas somente estar&atilde;o dispon&iacute;veis
    na matriz <varname>$HTTP_SESSION_VARS</varname>.
     <example>
      <title>
       Registrando uma vari&aacute;vel com <link
       linkend="ini.track-vars"><literal>track_vars</literal></link>
       habilitada
      </title>
      <programlisting role="php">
<![CDATA[
<?php
session_start();
if (isset($HTTP_SESSION_VARS['count'])) {
   $HTTP_SESSION_VARS['count']++;
}
else {
   $HTTP_SESSION_VARS['count'] = 0;
}
?>
]]>
      </programlisting>
     </example>
    </para>
    <para>
     Uso de <varname>$_SESSION</varname> (ou
    <varname>$HTTP_SESSION_VARS</varname> com PHP 4.0.6 ou inferior) &eacute;
    recomendado por seguran&ccedil;a e code readablity. Com
    <varname>$_SESSION</varname> ou
    <varname>$HTTP_SESSION_VARS</varname>, n&atilde;o &aacute; necessidade de usar
     as fun&ccedil;&otilde;es session_register()/session_unregister()/session_is_registered().
	  Usu&aacute;rios podem acessar vari&aacute;vel de sess&atilde;o como uma vari&aacute;vel normal.
	 <example>
     <title>
      Registrando uma vari&aacute;vel com $_SESSION.
      </title>
      <programlisting role="php">
<![CDATA[
<?php
session_start();
// Use $HTTP_SESSION_VARS with PHP 4.0.6 or less
if (!isset($_SESSION['count'])) {
    $_SESSION['count'] = 0;
} else {
    $_SESSION['count']++;
}
?>
]]>
      </programlisting>
     </example>
     <example>
      <title>
       Desregistrando uma vari&aacute;vel com $_SESSION.
      </title>
      <programlisting role="php">
<![CDATA[
<?php
session_start();
// Use $HTTP_SESSION_VARS with PHP 4.0.6 or less
unset($_SESSION['count']);
?>
]]>
      </programlisting>
     </example>
    </para>
    <para>
     Se a <link
    linkend="ini.register-globals"><literal>register_globals</literal></link>
    est&aacute; habilitada, ent&atilde;o todas as vari&aacute;veis globais podem ser registradas como 
    vari&aacute;veis de sess&atilde;o e as vari&aacute;veis de sess&atilde;o ser&atilde;o restauradas para a vari&aacute;vel 
    global correspondente. Visto que o PHP deve saber quais vari&aacute;veis globais
    est&atilde;o registradas como vari&aacute;veis de sess&atilde;o, usua&aacute;rios devem registrar vari&aacute;veis
    com a fun&ccedil;&atilde;o session_register() enquanto
    <varname>$HTTP_SESSION_VARS</varname>/<varname>$_SESSION</varname>
    n&atilde;o necessita utilizar session_register().
    <caution>
     <para>
      Se voc&ecirc; est&aacute; usando 
      <varname>$HTTP_SESSION_VARS</varname>/<varname>$_SESSION</varname>
      e desabilitada <link
      linkend="ini.register-globals"><literal>register_globals</literal></link>,
      n&atilde;o fa&ccedil;a uso de <function>session_register</function>,
      <function>session_is_registered</function> e
      <function>session_unregister</function>.
      </para>
      <para>
       Se voc&ecirc; habilita <link
       linkend="ini.register-globals"><literal>register_globals</literal></link>,
       <function>session_unregister</function> poderiam ser usadas desde que 
       as vari&aacute;veis de sess&atilde;o estejam registradas como vari&aacute;veis globais quando 
       os dados da sess&atilde;o n&atilde;o est&atilde;o em s&eacute;rie. Desabilitar <link
       linkend="ini.register-globals"><literal>register_globals</literal></link>
       &eacute; recomendado para ambas raz&otilde;es, seguran&ccedil;a e performance.
     </para>
    </caution>
    <example>
     <title>
      Registrando uma vari&aacute;vel com <link
      linkend="ini.register-globals"><literal>register_globals</literal></link>
      habilitada
      </title>
      <programlisting role="php">
<![CDATA[
<?php
if (!session_is_registered('count')) {
    session_register("count");
    $count = 0;
}
else {
    $count++;
}
?>
]]>
      </programlisting>
     </example>
    </para>
    <para>
     Se ambas <link
    linkend="ini.track-vars"><literal>track_vars</literal></link> e
    <link
    linkend="ini.register-globals"><literal>register_globals</literal></link>
    est&atilde;o habilitadas, ent&atilde;o as vari&aacute;veis globais e as entradas
    <varname>$HTTP_SESSION_VARS</varname>/<varname>$_SESSION</varname>
    far&atilde;o refer&ecirc;ncia ao mesmo valor para as vari&aacute;veis j&aacute; registradas.
    </para>
    <para>
     Se o usu&aacute;rio utiliza session_register() para registrar vari&aacute;vel de sess&atilde;o,
    <varname>$HTTP_SESSION_VARS</varname>/<varname>$_SESSION</varname>
    n&atilde;o ter&atilde;o esta vari&aacute;vel numa matriz at&eacute; que ela seja lida de um
    armaz&eacute;m de sess&atilde;o. (i.e. at&eacute; o pr&oacute;ximo pedido)
    </para>
   </section>
    
   <section id="session.idpassing">
    <title>Passando a ID de sess&atilde;o</title>
    <para>
     H&aacute; dois m&eacute;todos para propagar uma id de sess&atilde;o:
     <itemizedlist>
      <listitem>
       <simpara>
        Cookies
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        Par&acirc;metro URL 
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <para>
      M&oacute;dulo de sess&atilde;o suporta ambos os m&eacute;todos. Cookies s&atilde;o mais eficientes, mas se
    eles n&atilde;o estiverem autorizados (clientes n&atilde;o s&atilde;o obrigados a aceita-los),
	n&oacute;s n&atilde;o podemos conter deles. O segundo m&eacute;todo inclui a id de sess&atilde;o
    diretamente na URL.
    </para>
    <para>
     PHP &eacute; capaz de fazer isto transparentemente quando compilado com
    <link linkend="install.configure.enable-trans-sid">
    <literal>--enable-trans-sid</literal></link>. Se voc&ecirc; habilitar esta op&ccedil;&atilde;o,
     URIs ligadas ser&atilde;o automaticamente mudadas para conter a id 
	 de sess&atilde;o. Alternativamente, voc&ecirc; pode usar a constante
    <literal>SID</literal> que &eacute; definida, se o cliente n&atilde;o enviar
    o cookie apropriado.  <literal>SID</literal> &eacute; do 
	formul&aacute;rio <literal>session_name=session_id</literal> ou &eacute; uma string
    vazia.
     <note>
      <para>
      A diretriz <link linkend="ini.arg_separator.output">arg_separator.output</link>
     &php.ini; permite personalizar o argumento separador.
      </para>
     </note> 
    </para>
    <para>
     O seguinte exemplo demonstra como registrar uma vari&aacute;vel, e
    e como ligar corretamente a outra p&aacute;gina usando SID.
     <example>
      <title>Contar o n&uacute;mero de visitas de um simples usu&aacute;rio</title>
      <programlisting role="php">
<![CDATA[
<?php
if (!session_is_registered('count')) {
    session_register('count');
    $count = 1;
}
else {
    $count++;
}
?>

Hello visitor, you have seen this page <?php echo $count; ?> times.<p>;

<?php
# the <?php echo SID?> (<?=SID?> can be used if short tag is enabled) 
# is necessary to preserve the session id
# in the case that the user has disabled cookies
?>

To continue, <A HREF="nextpage.php?<?php echo SID?>">click here</A>
]]>
      </programlisting>
     </example>
    </para>
    <para>
     A <literal>&lt;?=SID?&gt;</literal> n&atilde;o &eacute; necess&aacute;rio, se
    <link linkend="install.configure.enable-trans-sid">
    <literal>--enable-trans-sid</literal></link> foi usada para compilar o PHP.
   </para>
   <note>
    <para>
     URLs n&atilde;o ligadas est&atilde;o assumidas para apontar para sites externos e
     portanto n&atilde;o anexam a SID, pois ela poderia escapar para outro servidor.
     </para>
    </note>
   </section>
   
   <section id="session.customhandler">
    <title>Session handlers customiz&aacute;veis</title>
    <para>
     Para implementar o armazenamento num banco de dados, ou qualque outra forma 
	de aramzenamento, voc&ecirc; vai precisar usar <function>session_set_save_handler</function>* para
    define as fun&ccedil;&otilde;es de armazenamento que s&atilde;o usadas (* to create a set of 
	user-level storage functions).
    </para>
   </section>
  </partintro>

&reference.session.functions;

 </reference>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

